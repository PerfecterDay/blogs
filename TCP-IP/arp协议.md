# ARP 协议
{docsify-updated}

知道主机的 IP 地址并不能让内核发送一帧数据给主机。内核（如以太网驱动程序）必须知道目的端的硬件地址才能发送数据。ARP 的功能是在 32 bit的 IP 地址和采用不同网络技术的硬件地址之间提供动态映射。

<center><img src="pics/arp.png" alt="" width="100%"></center>

ARP 请求的以太网目的地址为全1，表示的是特殊的广播地址，因为主机并不知道目的硬件地址，所以只能发送广播帧。电缆上的所有以太网络接口都要接收广播的数据帧。

arp 请求的帧类型是 0x0806 。

硬件类型字段表示硬件地址的类型。它的值为 1即表示以太网地址。  
协议类型字段表示要映射的协议地址类型。它的值为 0x0800 即表示 IP 地址。它的值与包含IP数据报的以太网数据帧中的类型字段的值相同，这是有意设计的。

接下来的两个1字节的字段，硬件地址长度和协议地址长度分别指出硬件地址和协议地址的长度，以字节为单位。对于以太网上 IP地址的ARP请求或应答来说，它们的值分别为 6和4。

操作字段指出四种操作类型，它们是 ARP请求（值为1）、ARP应答（值为2）、RARP请求（值为3）和RARP应答（值为4）（我们在第5章讨论RARP）。这个字段必需的，因为 ARP请求和ARP应答的帧类型字段值是相同的。

接下来的四个字段是发送端的硬件地址（在本例中是以太网地址）、发送端的协议地址（I P地址）、目的端的硬件地址和目的端的协议地址。

**对于一个ARP请求来说，除目的端硬件地址外的所有其他的字段都要填充值。当系统收到一份目的端为本机的 ARP请求报文后，它就把硬件地址填进去，然后用两个目的端地址分别替换两个发送端地址，并把操作字段置为 2，最后把它发送回去。**

ARP高效运行的关键是由于每个主机上都有一个 ARP高速缓存。这个高速缓存存放了最近IP地址到硬件地址之间的映射记录。高速缓存中每一项的生存时间一般为 20分钟，起始时间从被创建时开始算起。可以使用 `arp -a` 命令查看本机的 ARP 缓存。