# Floable 核心概念
{docsify-updated}

Floable 涵盖了流程定义、流程实例和执行实例这3个基本概念。

## 流程定义
一个流程模型通过执行部署操作可以生成一个流程定义，执行几次部署操作就可以生成几个流程定义。通常流程模型修改后，都需要执行部署操作发布新版本
的流程定义。所以一个流程模型可能会部署多个版本的流程定义，二者之间是一对多的关系。
一个流程定义包括.bpmn和.png两个文件。.bpmn文件是流程步骤的说明，是遵循BPMN 2.0标准的XML文件。.png文件是Flowable生成的流程图片。

<center><img src="/pics/flowable_def.png" alt=""></center>

## 流程实例
流程定义部署后，用户（或系统）即可调用Flowable的核心API根据流程定义发起一个流程实例，并通过该API管理该流程实例的执行。一个流程定义可以发起
多个流程实例。流程定义是静态的，流程实例是动态的。

流程定义与流程实例的关系类似Java类与对象，一个Java类可以实例化多个对象，一个流程定义也可以发起多个流程实例。

流程实例对应的数据表是 `ACT_HI_PROCINST` ，该表存储了流程实例的基本信息，而流程实例的节点信息主要存储在 `ACT_HI_ACTINST` 表中，流程任务信息
主要存储在 `ACT_HI_TASKINST` 表中，流程变量信息主要存储在 `ACT_HI_VARINST` 表中。 `ACT_HI_PROCINST` 为主表，其他表通过 `PROC_INST_ID_` 字段与 `ACT_HI_PROCINST` 表的 `ID_` 字段关联。

<center><img src="/pics/flowable_instance.png" alt=""></center>

## 执行实例
在Flowable中每启动一个流程就会创建一个流程实例，每个流程实例至少会有一个执行实例，当流程执行过程中遇到并行分支或多实例任务时，就会生成多个
执行实例。

<center><img src="/pics/flowable_exec.png" alt=""></center>

流程启动后，会在 `ACT_RU_EXECUTION` 表中创建两个执行实例，一个是流程的主执行实例（即流程实例），另一个是流程的子执行实例。流程
每执行一步操作，都会更新子执行实例，来表明当前流程的执行进度。当流程流经第一个并行网关后，会新增2个子执行实例，此时共有3个子执行实例。再加
上流程的主执行实例，一共可以在``ACT_RU_EXECUTION` 表中查询到4个执行实例。所有的子执行实例都按照规则执行完毕时，流程主执行实例也随之结束。

执行实例对应的数据表是 `ACT_RU_EXECUTION` ，该表存储了执行实例的基本信息，而执行实例的任务信息主要存储在 `ACT_RU_TASK` 表中，执行实例的变量
信息主要存储在 `ACT_RU_VARINST` 表中。 `ACT_RU_ EXECUTION` 为主表，其他表通过 `EXECUTION_ID_` 字段与 `ACT_RU_EXECUTION` 表的 `ID_` 字段关联。


## 工作流引擎服务
`ProcessEngine` 接口是Flowable的门面接口，也是最重要的API，其他核心服务API都可以通过 `ProcessEngine` 接口来获取。Flowable核心API主要有以下9个:
+ `RepositoryService` ：提供流程部署和流程定义的操作方法，如流程定义的挂起、激活等。
+ `RuntimeService` ：提供运行时流程实例的操作方法，如流程实例的发起、流程变量的设置等。
+ `TaskService` ：提供运行时流程任务的操作方法，如任务的创建、办理、指派、认领和删除等。
+ `HistoryService` ：提供历史流程数据的操作方法，如历史流程实例、历史变量、历史任务的查询等。
+ `ManagementService` ：提供对工作流引擎进行管理和维护的方法，如数据库表数据、表元数据的查询和执行命令。
+ `IdentityService` ：提供用户或者组的操作方法，如用户的增、删、改、查等。
+ `FormService` ：提供流程表单的操作方法，如表单获取、表单保存等。
+ `DynamicBpmnService` ：提供流程定义的动态修改方法，从而避免重新部署它。
+ `ProcessMigrationService` ：用于支持流程实例的迁移和升级。

```
//获取存储服务RepositoryService
RepositoryService repositoryService = processEngine.getRepositoryService();
//获取运行时服务RuntimeService
RuntimeService runtimeService = processEngine.getRuntimeService();
//获取任务服务TaskService
TaskService taskService = processEngine.getTaskService();
//获取历史服务HistoryService
HistoryService historyService = processEngine.getHistoryService();
//获取表单服务FormService
FormService formService= processEngine.getFormService();
//获取身份服务IdentityService
IdentityService identityService = processEngine.getIdentityService();
//获取管理服务ManagementService
ManagementService managementService = processEngine.getManagementService();
//获取动态BPMN服务DynamicBpmnService
DynamicBpmnService dynamicBpmnService = processEngine.getDynamicBpmnService();
//获取流程迁移服务ProcessMigrationService
ProcessMigrationService processMigrationService = processEngine.getProcessMigrationService();
```

