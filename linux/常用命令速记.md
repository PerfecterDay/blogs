# 常用命令速记
{docsify-updated}

### su 和 sudo
+ `su [user]`: 切换到 [user] 用户，需要输入切换到的用户的密码，省略 user 的话默认切换到 root 用户。执行完命令后，使用 exit 可以切换到原用户。
+ `su -` 与 `su` 的区别：两者都是切换到root 用户，但是前者会连shell 环境一起切换。
+ `sudo [command]`: 以 root 权限执行命令，需要输入当前用户的密码，一般成功后15分钟内 sudo 无需再输入密码。但是这些都是由配置文件 `/etc/sudoers` 来进行授权的，就是说如果用户没有sudo权限，也是无法执行该命令的。 可以使用 visudo 命令修改其中的配置。

示例配置：  
1. `root  ALL=(ALL)  ALL -> 用户  允许登陆的主机位置=（可以切换的账户） 可以执行的命令`: 该配置表示 `root` 用户在任意位置切换到任意账户执行任意命令。
2. `%admin	 ALL=(ALL) ALL ->  用户组 允许登陆的主机位置=（可以切换的账户） 可以执行的命令`:  admin用户组在任意位置切换到任意账户执行任意命令。

### 系统状态查看
0. 查看进程: `pgrep`
1. 显示架构: `arch`
2. 查看Linux系统版本: `uname -a`
3. 查看某个时间点的进程信息: `ps -lef`
    + UID：启动这些进程的用户。
    + PID：进程的进程ID。 
    + PPID：父进程的进程号（如果该进程是由另一个进程启动的）。
    + C：进程生命周期中的CPU利用率。
    + STIME：进程启动时的系统时间。
    + TTY：进程启动时的终端设备。
    + TIME：运行进程需要的累计CPU时间。
    + CMD：启动的程序名称。
    + F：内核分配给进程的系统标记。
    + S：进程的状态（ O代表正在运行； S代表在休眠； R代表可运行，正等待运行； Z代表僵化，进程已结束但父进程已不存在； T代表停止）。
    + PRI：进程的优先级（越大的数字代表越低的优先级）。
    + NI：谦让度值用来参与决定优先级。
    + ADDR：进程的内存地址。
    + SZ：假如进程被换出，所需交换空间的大致大小。
    + WCHAN：进程休眠的内核函数的地址。  

4. 结束进程:`kill/killall`  
    在Linux中，进程之间通过信号来通信。进程的信号就是预定义好的一个消息，进程能识别它并决定忽略还是作出反应。进程如何处理信号是由开发人员通过编程来决定的。大多数编写完善的程序都能接收和处理标准Unix进程信号。
    |信号|名称|描述|
    |--|:--:|--|
    |1 |HUP| 挂起
    |2 |INT| 中断
    |3 |QUIT| 结束运行
    |9 |KILL| 无条件终止
    |11 |SEGV| 段错误
    |15 |TERM|尽可能终止
    |17 |STOP| 无条件停止运行，但不终止
    |18 |TSTP| 停止或暂停，但继续在后台运行
    |19 |CONT| 在STOP或TSTP之后恢复执行

    1. `kill -9 pid`  
    2. `killall` 不仅支持pid参数，还支持通配符：`killall http*`

5. 磁盘/文件管理/内存
   1. 查看磁盘空间使用情况: `df -h`
   2. 查看当前目录所占空间大小: `du -sh`
   3. 打包：`tar -cvf etc.tar /etc <==仅打包，不压缩！` -c :打包选项, -v :显示打包进度, -f :使用档案文件
   4. 解包：`tar -xvf demo.tar`  -x:解包选项  -z:解压gz文件  -j:解压bz2文件  -J:解压xz文件
   5. 压缩文件：`gzip demo.txt`
   6. 解压缩文件：`gunzip demo.tar.gz`
   7. iostat工具
      1. -C 显示CPU使用情况
      2. -d 显示磁盘使用情况
      3. -k 以 KB 为单位显示
      4. -m 以 M 为单位显示
      5. -N 显示磁盘阵列(LVM) 信息
      6. -n 显示NFS 使用情况
      7. -p[磁盘] 显示磁盘和分区的情况
      8. -x 显示详细信息
         + 如果%iowait的值过高，表示硬盘存在I/O瓶颈。
         + 如果 %util 接近 100%，说明产生的I/O请求太多，I/O系统已经满负荷，该磁盘可能存在瓶颈。
         + 如果 svctm 比较接近 await，说明 I/O 几乎没有等待时间；
         + 如果 await 远大于 svctm，说明I/O 队列太长，io响应太慢，则需要进行必要优化。
         + 如果avgqu-sz比较大，也表示有大量io在等待。
   8. 创建文件: `touch testFile`
   9. 拷贝文件：`cp source destination`， -i 选项会提示是否覆盖已有文件
   10. 移动文件：`mv file1 file2`, mv命令可以将文件和目录移动到另一个位置或重新命名
   11. 创建文件夹：`mkdir -p [dirName]`, -p 可以在上层目录不存在时递归创建
   
6. 性能监控
   1. [top](Top性能监控.md)
   2. CPU使用率： `sar [-u|-r|-q] 1 2` 每秒采样一次，总共采样2次; -r:显示内存; -q:查看运行队列中的进程数、系统上的进程大小、平均负载等
   3. 查看内存用量：`free -m` MB为单位显示
   4. 查看cpu、内存、使用情况：`vmstat n m` （n 为监控频率、m为监控次数）

7. 网络监控
   1. `netstat [-atlp]` : -a：所有端口；-t:列出所有 tcp 端口; -l:监听的状态；-p:pid信息
   2. `lsof` :列出当前系统打开文件的工具; `-i [tcp|udp:端口]`查看某个tcp/udp端口被哪个进程占用；`-p pid`查看pid进程打开的文件和端口
   3. `route -n` :查看路由状态
   4. `traceroute IP` :探测前往地址IP的路由路径
   5. `host domain` :DNS查询,寻找域名domain对应的IP；也可以使用 nslookup
   6. `host ip` :查看IP对应的域名
   7. `scp localpath ID@host:path` :将本地localpath指向的文件上传到远程主机的path路径
   8. `scp -r ID@site:path localpath` :遍历下载path路径下的整个文件系统，到本地的localpath

### 软件包管理
各种主流Linux发行版都采用了某种形式的包管理系统来控制软件和库的安装。PMS利用一个数据库来记录各种相关内容：
+ Linux系统上已安装了什么软件包；
+ 每个包安装了什么文件；
+ 每个已安装软件包的版本。
软件包存储在服务器上，可以利用本地Linux系统上的PMS工具通过互联网访问。这些服务器称为仓库（repository）。可以用PMS工具来搜索新的软件包，或者是更新系统上已安装软件包。软件包通常会依赖其他的包，为了前者能够正常运行，被依赖的包必须提前安装在系统中。PMS工具将会检测这些依赖关系，并在安装需要的包之前先安装好所有额外的软件包。PMS的不足之处在于目前还没有统一的标准工具。不管你用的是哪个Linux发行版，本书到目前为止所讨论的bash shell命令都能工作，但对于软件包管理可就不一定了。PMS工具及相关命令在不同的Linux发行版上有很大的不同。Linux中广泛使用的两种主要的PMS基础工具是 dpkg 和 rpm 。

#### 基于 Debian 的 dpkg
dpkg命令是基于Debian系PMS工具的核心。包含在这个PMS中的其他工具有：
+ apt-get 
+ apt-cache 
+ aptitude 

到目前为止，最常用的命令行工具是aptitude，这是有原因的。aptitude工具本质上是apt工具和dpkg的前端。dpkg是软件包管理系统工具，而aptitude则是完整的软件包管理系统。
1. 找到特定的软件包: `aptitude search package_name`,在每个包名字之前都有一个p或i。如果看到一个i，说明这个包现在已经安装到了你的系统上了。如果看到一个p或v，说明这个包可用，但还没安装
2. 安装软件包：`aptitude install package_name`
3. 用软件仓库中的新版本妥善地更新系统上所有的软件包，可用safe-upgrade选项：`aptitude safe-upgrade`
4. 要想只删除软件包而不删除数据和配置文件，可以使用 aptitude 的 remove 选项。要删除软件包和相关的数据和配置文件，可用 purge 选项:
   1. `sudo aptitude purge wine`,删除后使用 `aptitude search wine`, 软件包前面如果是 p 说明配置文件已经删除
   2. `sudo aptitude remove wine`，删除后使用 `aptitude search wine`，如果在软件包名称的前面看到一个c，意味着软件已删除，但配置文件尚未从系统中清除
5. 快速显示某个特定包的详细信息：`aptitude show package_name`
6. 所有跟某个特定软件包相关的所有文件的列表: `dpkg -L package_name`
7. 查找某个特定文件属于哪个软件包: `dpkg --search absolute_file_name`

aptitude默认的软件仓库位置是在安装Linux发行版时设置的。具体位置存储在文件 `/etc/apt/sources.list` 中，使用下面的结构来指定仓库源：

`deb (or deb-src) address distribution_name package_type_list`
+ deb或deb-src的值表明了软件包的类型。deb值说明这是一个已编译程序源，而deb-src值则说明这是一个源代码的源
+ address: 软件仓库的Web地址
+ distribution_name条目是这个特定软件仓库的发行版版本的名称
+ package_type_list条目可能并不止一个词，它还表明仓库里面有什么类型的包。如main、restricted、universe和partner这样的值

#### 基于Red Hat 的 RPM
基于Red Hat的系统也有几种不同的可用前端工具。常见的有以下3种。
1. yum：在 Red Hat 和 Fedora 中使用。
2. urpm：在 Mandriva 中使用。
3. zypper：在 openSUSE 中使用。

常用命令：
1. 要找出系统上已安装的包：`yum list installed > installed_software`
2. 查看包是否已安装: `yum list package_name`
3. 查找某个特定文件属于哪个软件包: `yum provides file_name`
4. 安装软件： `yum install package_name`
5. 手动下载rpm安装文件并用yum安装，这叫作本地安装: `yum localinstall package_name.rpm`
6. 列出所有已安装包的可用更新: `yum list updates`
7. 更新某个安装包：`yum update package_name`
8. 对更新列表中的所有包进行更新：`yum update`
9. 只删除软件包而保留配置文件和数据文件: `yum remove package_name`
10. 要删除软件和它所有的文件: `yum erase package_name`


#### 日常需要
1. Ubuntu 升级 JDK
   `sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk-11/bin/java 1`
   `sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk-11/bin/javac 1`
   `sudo update-alternatives --install /usr/bin/javap javap /usr/lib/jvm/jdk-11/bin/javap 1`
   `sudo update-alternatives --install /usr/bin/javah javah /usr/lib/jvm/jdk-11/bin/javah 1`
   `sudo update-alternatives --install /usr/bin/javadoc javadoc /usr/lib/jvm/jdk-11/bin/javadoc 1`
   `sudo update-alternatives --config java`
   `sudo update-alternatives --config javac`
   `sudo update-alternatives --config javap`
   `sudo update-alternatives --config javah`
   `sudo update-alternatives --config javadoc`