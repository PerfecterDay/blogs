# 文件及目录管理
{docsify-updated}

- [文件及目录管理](#文件及目录管理)
	- [常用命令汇总](#常用命令汇总)
	- [文件查找-find](#文件查找-find)
	- [Chmod 总结](#chmod-总结)

## 常用命令汇总
1. 创建及删除
	+ 创建：`mkdir dir`
	+ 删除：`rm file`
	+ 删除非空目录：`rm -rf file目录`
	+ 删除日志 `rm *log` (等价: $`find ./ -name “*log” -exec rm {}` ;)
	+ 删除特殊文件名的日志(文件名以-开头，-在rm 中是option 开头字段): `rm ./-filename `
	+ 移动：`mv 源文件路径 目的文件路径`  源路径 -> 目的路径
	+ 复制：`cp 源文件路径 目的文件路径` (复制目录：`cp -r 源文件路径 目的文件路径` )
2. 创建及删除
	+ 找到文件/目录位置：`cd`
	+ 切换到上一个工作目录： `cd -`
	+ 切换到home目录： `cd` 或者 `cd ~`
	+ 显示当前路径: `pwd`
	+ 更改当前工作路径为path: `$cd path`
3. 列出目录项
	+ 显示当前目录下的文件: `ls`
	+ 按时间排序，以列表的方式显示目录项: `ls -lrt`
4. 查找目录及文件 find/locate
	+ 搜寻文件或目录: `find ./ -name "core*" | xargs file`
	+ 查找目标文件夹中是否有obj文件:`find ./ -name '*.o'`
	+ 递归当前目录及子目录删除所有.o文件：`find ./ -name "*.o" -exec rm {} \;`
	+ 寻找包含有string的路径: `locate string`
	+ 与find不同，locate并不是实时查找。你需要更新数据库，以获得最新的文件索引信息: `updatedb`
5. 查看文件内容
	+ 显示时同时显示行号: `cat -n file`
	+ 按页显示文件列表内容: `ls -al | more`
	+ 只看前10行: `head -10 file`
	+ 显示文件倒数五行: `tail -5 file`
	+ 查看两个文件间的差别: `diff file1 file2`
	+ 动态显示文本最新信息: `tail -f crawler.log`
6. 查找文件内容
	+ `egrep '03.1\/CO\/AE' TSF_STAT_111130.log.012`
	+ `cat TSF_STAT_111130.log.012 | grep '03.1\/CO\/AE'`
7. 文件与目录权限修改
	+ 改变文件的拥有者: `chown owner-name file`
	+ 改变文件读、写、执行等属性: `chmod u+x start.sh`
	+ 递归子目录修改： `chown -R tuxapp source/`
	+ 增加脚本可执行权限： `chmod a+x myscript`
8. 给文件增加别名
	+ `ln cc ccAgain` :硬连接；删除一个，将仍能找到；
	+ `ln -s cc ccTo` :符号链接(软链接)；删除源，另一个无法使用；（后面一个ccTo 为新建的文件）

## 文件查找-find

查找txt和pdf文件:
```find . \( -name "*.txt" -o -name "*.pdf" \) -print```

正则方式查找.txt和pdf:
```find . -regex  ".*\(\.txt\|\.pdf\)$"```

`-iregex`： 忽略大小写的正则

否定参数 ,查找所有非txt文本:
```find . ! -name "*.txt" -print```

指定搜索深度,打印出当前目录的文件（深度为1)

```find . -maxdepth 1 -type f```

定制搜索
- 按类型搜索
	`find . -type d -print`  //只列出所有目录  
	`-type f->文件|l->符号链接|d->目录`

find支持的文件检索类型可以区分普通文件和符号链接、目录等，但是二进制文件和文本文件无法直接通过find的类型区分出来；

file命令可以检查文件具体类型（二进制或文本）::

	$file redis-cli  # 二进制文件
	redis-cli: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped
	$file redis.pid  # 文本文件
	redis.pid: ASCII text

所以,可以用以下命令组合来实现查找本地目录下的所有二进制文件::

	ls -lrt | awk '{print $9}'|xargs file|grep  ELF| awk '{print $1}'|tr -d ':'


- 按时间搜索
	* -atime 访问时间 (单位是天，分钟单位则是-amin，以下类似）
	* -mtime 修改时间 （内容被修改）
	* -ctime 变化时间 （元数据或权限变化）

最近第7天被访问过的所有文件::

	find . -atime 7 -type f -print
最近7天内被访问过的所有文件::

	find . -atime -7 -type f -print
查询7天前被访问过的所有文件::

	find . -atime +7 -type f -print

- 按大小搜索：
w字 k M G
寻找大于2k的文件::

	find . -type f -size +2k
按权限查找::

	find . -type f -perm 644 -print //找具有可执行权限的所有文件
按用户查找::

	find . -type f -user weber -print// 找用户weber所拥有的文件


找到后的后续动作

- 删除
删除当前目录下所有的swp文件::

	find . -type f -name "*.swp" -delete
另一种语法::

	find . type f -name "*.swp" | xargs rm

- 执行动作（强大的exec）
将当前目录下的所有权变更为weber::

	find . -type f -user root -exec chown weber {} \; 

注：{}是一个特殊的字符串，对于每一个匹配的文件，{}会被替换成相应的文件名；

将找到的文件全都copy到另一个目录::

	find . -type f -mtime +10 -name "*.txt" -exec cp {} OLD \;

- 结合多个命令
如果需要后续执行多个命令，可以将多个命令写成一个脚本。然后 -exec 调用时执行脚本即可::

	-exec ./commands.sh {} \;

-print的定界符

默认使用'\\\n'作为文件的定界符；

-print0 使用'\\\0'作为文件的定界符，这样就可以搜索包含空格的文件；

## Chmod 总结
Linux chmod（英文全拼：change mode）命令是控制用户对文件的权限的命令。  
Linux/Unix 的文件调用权限分为三级 : 文件所有者（Owner）、用户组（Group）、其它用户（Other Users）。

<center><img src="pics/chmod.jpeg" width="50%"></center>

只有文件所有者和超级用户可以修改文件或目录的权限。可以使用绝对模式（八进制数字模式），符号模式指定文件的权限。
<center><img src="pics/rwx-standard-unix-permission-bits.png" width="50%"></center>

语法：`chmod [-cfvR] [--help] [--version] mode file...`

其中：
- u 表示该文件的拥有者，g 表示与该文件的拥有者属于同一个群体(group)者，o 表示其他以外的人，a 表示这三者皆是。
- \+ 表示增加权限、- 表示取消权限、= 表示唯一设定权限。
- r 表示可读取，w 表示可写入，x 表示可执行，X 表示只有当该文件是个子目录或者该文件已经被设定过为可执行。

其他参数说明：
+ -c : 若该文件权限确实已经更改，才显示其更改动作
+ -f : 若该文件权限无法被更改也不要显示错误讯息
+ -v : 显示权限变更的详细资料
+ -R : 对目前目录下的所有文件与子目录进行相同的权限变更(即以递归的方式逐个变更)
+ --help : 显示辅助说明
+ --version : 显示版本


u->user->文件所有者  
g->group->文件所有者所在组  
o->others->所有其他用户  
a->all->所有用户, 相当于 ugo  

\+ -> 为指定的用户类型增加权限  
\- -> 去除指定用户类型的权限  
= -> 设置指定用户权限的设置，即将用户类型的所有权限重新设置

permission 的符号模式表:

r	读	设置为可读权限  
w	写	设置为可写权限  
x	执行权限	设置为可执行权限  
X	特殊执行权限	只有当文件为目录文件，或者其他类型的用户有可执行权限时，才将文件权限设置可执行  
s	setuid/gid	当文件被执行时，根据who参数指定的用户类型设置文件的setuid或者setgid权限  
t	粘贴位	设置粘贴位，只有超级用户可以设置该位，只有文件所有者u可以使用该位  