# makefile
{docsify-updated}

Makefile文件由一系列规则（rules）构成。每条规则的形式如下。

```
<target> : <prerequisites> 
[tab]  <commands>
```
上面第一行冒号前面的部分，叫做"目标"（target），冒号后面的部分叫做"前置条件"（prerequisites）；第二行必须由一个tab键起首，后面跟着"命令"（commands）。  
"目标"是必需的，不可省略；"前置条件"和"命令"都是可选的，但是两者之中必须至少存在一个。  
每条规则就明确两件事：**构建目标的前置条件是什么，以及如何构建**。下面就详细讲解，每条规则的这三个组成部分。


### 目标（target）
一个目标（target）就构成一条规则。目标通常是文件名，指明Make命令所要构建的对象，比如 mbr.bin 。目标可以是一个文件名，也可以是多个文件名，之间用空格分隔。  
除了文件名，目标还可以是某个操作的名字，这称为"**伪目标**"（phony target）。如：
```
clean:
      rm *.o
```
上面代码的目标是clean，它不是文件名，而是一个操作的名字，属于"伪目标 "，作用是删除对象文件。可以执行 `make clean` 类执行目标构建。  
但是，如果当前目录中，正好有一个文件叫做clean，那么这个命令不会执行。因为Make发现clean文件已经存在，就认为没有必要重新构建了，就不会执行指定的rm命令。  
为了避免这种情况，可以明确声明clean是"伪目标"，写法如下:
```
.PHONY: clean
clean:
        rm *.o temp
```

声明clean是"伪目标"之后，make就不会去检查是否存在一个叫做clean的文件，而是每次运行都执行对应的命令。  
**如果Make命令运行时没有指定目标，默认会执行Makefile文件的第一个目标。**

### 前置条件（prerequisites）
前置条件通常是一组文件名，之间用空格分隔。它指定了"目标"是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的last-modification时间戳比目标的时间戳新），"目标"就需要重新构建。
如果前置条件有多个，那么这多个条件的构建顺序与makefile中书写的顺序是一致的，除非有另外的依赖定义。
默认情况下，执行顺序与先决条件列表中指定的相同，除非这些先决条件之间定义有任何依赖关系。
`abc: x y z` -> 顺序是x y z。

```
abc: x y z
y : z
```
顺序应该是x z y。

但理想情况下，你应该设计你的Makefiles，使它不依赖于先决条件的指定顺序。也就是说，如果y应该在z之后执行，就必须有一个y : z的依赖关系。

### 命令
命令（commands）表示如何更新目标文件，由一行或多行的Shell命令组成。它是构建"目标"的具体指令，它的运行结果通常就是生成目标文件。  
每行命令之前必须有一个tab键。如果想用其他键，可以用内置变量.RECIPEPREFIX声明。


