# socket-高级主题
{docsify-updated}

## 零拷贝传输：sendfile()系统调用 
像 Web 服务器和文件服务器这样的应用程序常常需要将磁盘上的文件内容不做修改地通过（已连接）套接字传输出去。一种方法是通过循环按照如下方式处理：
```
while((n =read(diskfilefd,buf,BUF_SIZE)) > 0){
	write(sockfd,buf,n)
}
```
对于许多应用程序来说，这样的循环是完全可接受的。但是，如果我们需要通过套接字频繁地传输大文件的话，这种技术就显得很不高效。为了传输文件，我们必须使用两个系统调用（可能需要在循环中多次调用）：一个用来将文件内容从内核缓冲区 cache 中拷贝到用户空间，另一个用来将用户空间缓冲区拷贝回内核空间，以此才能通过套接字进行传输。图61-1左侧展示了这种场景。如果应用程序在发起传输之前根本不对文件内容做任何处理的话，那么这种两步式的处理就是一种浪费。

系统调用 sendfile()被设计为用来消除这种低效性。如图61-1 右侧所示，当应用程序调用sendfile()时，文件内容会直接传送到套接字上，而不会经过用户空间。这种技术被称为零拷贝传输（zero-copy transfer）。 

<center><img src="pics/zero-copy.png" width="40%"></center>