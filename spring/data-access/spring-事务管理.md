# Spring 事务管理
{docsify-updated}

全面的事务支持是使用 Spring 框架的最重要原因之一。Spring 框架为事务管理提供了一致的抽象，可带来以下优势：
+ 跨不同事务 API（如 Java Transaction API (JTA)、JDBC、Hibernate 和 Java Persistence API (JPA)) 的一致编程模型。
+ 支持声明式事务管理。
+ 与复杂的事务 API（如 JTA）相比，程序化事务管理 API 更简单。
+ 与 Spring 的数据访问抽象出色集成。

## 全局事务与本地事务
传统上，EE 应用程序开发人员在事务管理方面有两种选择：全局事务或本地事务，这两种选择都有很大的局限性。

### 全局事务
全局事务可让您使用多个事务资源，通常是关系数据库和消息队列。应用服务器通过 JTA 管理全局事务，这是一个繁琐的 API（部分原因是其异常模型）。此外，JTA 的 `UserTransaction` 通常需要从 JNDI 获取，这意味着要使用 JTA 还需要使用 JNDI。全局事务的使用限制了应用程序代码的潜在重用，因为 JTA 通常只能在应用服务器环境中使用。

以前，使用全局事务的首选方法是通过 EJB CMT（容器管理事务）。CMT 是一种声明式事务管理（有别于编程式事务管理）。尽管使用 EJB 本身就必须使用 JNDI，但 EJB CMT 消除了与事务相关的 JNDI 查找需求。它消除了编写 Java 代码来控制事务的大部分（但不是全部）需求。CMT 的主要缺点是与 JTA 和应用服务器环境相关联。此外，只有选择在 EJB（或至少在事务 EJB 门面后面）中实现业务逻辑时，才能使用 CMT。总的来说，EJB 的缺点太多了，所以这不是一个有吸引力的提议，尤其是在声明式事务管理有其他令人信服的替代方案的情况下。

### 本地事务
本地事务是特定于资源的，例如与 JDBC 连接相关的事务。本地事务可能更容易使用，但也有很大的缺点：**它们不能跨多个事务资源运行**。例如，使用 JDBC 连接管理事务的代码无法在全局 JTA 事务中运行。由于应用服务器不参与事务管理，因此无法帮助确保跨多个资源的正确性。(值得注意的是，大多数应用程序只使用一个事务资源）。另一个缺点是本地事务对编程模型具有侵入性。

### Spring 的事务支持
Spring 解决了全局和本地事务的缺点。它能让应用程序开发人员在任何环境中使用一致的编程模型。你只需编写一次代码，就能在不同环境中受益于不同的事务管理策略。Spring Framework 提供声明式和编程式事务管理。大多数用户更喜欢声明式事务管理，我们在大多数情况下都推荐使用声明式事务管理。

在编程式事务管理中，开发人员使用 Spring Framework 事务抽象，它可以在任何底层事务基础架构上运行。在首选的声明式模型中，开发人员通常只编写很少或根本不编写与事务管理相关的代码，因此不依赖 Spring Framework 事务 API 或任何其他事务 API。

