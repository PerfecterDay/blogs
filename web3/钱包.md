# Hierarchical Deterministic Wallet-HD Wallet
{docsify-updated}

## 什么是 HD Wallet
HD Wallet = Hierarchical Deterministic Wallet
+ Hierarchical（分层）：密钥按照树结构派生
+ Deterministic（确定性）：相同种子生成的树永远一致 → 支持恢复
+ 核心标准：BIP32、助记词：BIP39、路径：BIP44

```
     [Master Seed]
            ↓
     +------------------------------+
     | 构造 HMAC-SHA512(seed)       |
     +------------------------------+
          ↓             ↓
     Master Private Key  Chain Code
                (Level 0)
                        ↓
                m (根密钥对)
                        ↓
                ┌─────────────┐
                │             │
             m/0           m/1   Level 1
             │              │
       ┌─────┴─────┐       ...
       │           │
  m/0/0         m/0/1     Level 2
```

每个节点（包括根节点）有：
+ 一个 私钥/公钥
+ 一个 链码（chain code）：用于生成新的子密钥，确保安全


根密钥对来源于 种子（seed）：
+ 种子由助记词 + 可选密码 生成（BIP39）
+ 使用 HMAC-SHA512(seed, "Bitcoin seed") 得到 512bit 输出：
    + 前256位 = master private key
    + 后256位 = chain code（根链码）

```
HMAC-SHA512(key = parent_chain_code, data = parent_key || index) → 512-bit result

child_private_key = (parent_private_key + left_half_of_result) mod curve_order
child_chain_code = right_half_of_result
```


## BIP44 标准
一般钱包使用 BIP44 标准：
```
m / purpose' / coin_type' / account' / change / address_index
```

| 字段          | 含义                                   | 示例                    |
| ------------- | -------------------------------------- | ----------------------- |
| m             | 主（根）私钥                           | (固定)                  |
| purpose'      | 用固定值 `44'` 表示符合 BIP44          | 44'                     |
| coin_type'    | 币种标识（SLIP44 定义）                | 比特币: 0'，以太坊: 60' |
| account'      | 账户编号，一个种子下可有多个账户       | 0'（第一个账户）        |
| change        | 0 表示外部（接收），1 表示内部（找零） | 0                       |
| address_index | 生成第 n 个地址                        | 0, 1, 2, ...            |


### Hardened vs Non-Hardened 派生
| 派生方式    | 是否需父私钥 | 安全性 | 允许公钥推导子公钥？             |
| ----------- | ------------ | ------ | -------------------------------- |
| 非 Hardened | 否           | 较弱   | 可以，从父公钥和 chain code 推导 |
| Hardened    | 是           | 更强   | 不可以（更安全）                 |

路径中 ' 表示 hardened，例如：
m/44'/60'/0'/0/0 → 前三个都是 hardened
